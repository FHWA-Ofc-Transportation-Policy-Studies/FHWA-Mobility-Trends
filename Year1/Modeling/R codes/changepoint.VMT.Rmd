---
title: "Changepoint Analysis VMT"
output: html_document
date: "2023-02-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## VMT Changepoint 
```{r VMT  vs. Unemploymnet, echo=FALSE}
setwd("/Users/csuffaculty/Desktop/FHWA")

#read the dataset
dat<-read.csv("Data20221210.csv", header=TRUE)
library(ggplot2)
library(segmented)

VMT.dat<-dat[,colSums(is.na(dat))==0]
VMT.dat.sub<-VMT.dat[,c("year","VMT","Unemployment.Rate.1","TransitPMT","TotLaneMiles","EVPrivateandPublicChargingStationLocations","populationTelework")]
VMT.dat.sub$VMT.1<-c(NA,VMT.dat.sub[1:19,"VMT"])
plot.unemp<-ggplot(VMT.dat.sub, aes(x = Unemployment.Rate.1, y=VMT))+geom_point() #plot raw data
lm.unemp<-lm(VMT ~ Unemployment.Rate.1, data=VMT.dat.sub) #fit linear model
```

```{r changepoint analysis, echo=FALSE}
seg.unemp<-segmented(lm.unemp, seg.Z = ~ Unemployment.Rate.1)
summary(seg.unemp)
slope(seg.unemp)
confint(seg.unemp)
plot.segmented(seg.unemp, res=TRUE, col=2, xlab="Unemployment Rate", ylab="VMT", pch=16)
unemp.fitted<-fitted(seg.unemp)
unemp.model<-data.frame(Unemployment=VMT.dat.sub$Unemployment.Rate.1, VMT=unemp.fitted)
#plot.unemp+geom_line(data = unemp.model, aes(x = Unemployment, y = VMT), colour="red")
```


```{r VMT vs. TotLaneMiles, echo=FALSE}
plot.TotLaneMiles<-ggplot(VMT.dat.sub, aes(x = TotLaneMiles, y=VMT))+geom_point() #plot raw data
lm.TotLaneMiles<-lm(VMT ~ TotLaneMiles, data=VMT.dat.sub) #fit linear model
```

```{r changepoint analysis TotLaneMiles, echo=FALSE}
seg.TotLaneMiles<-segmented(lm.TotLaneMiles, seg.Z = ~ TotLaneMiles)
summary(seg.TotLaneMiles)
slope(seg.TotLaneMiles)
confint(seg.TotLaneMiles)
plot.segmented(seg.TotLaneMiles, res=TRUE, col=2, xlab="Total Lane Miles", ylab="VMT", pch=16)
TotLaneMiles.fitted<-fitted(seg.TotLaneMiles)
TotLaneMiles.model<-data.frame(Total.Lane.Miles=VMT.dat.sub$TotLaneMiles, VMT=TotLaneMiles.fitted)
#plot.TotLaneMiles+geom_line(data = TotLaneMiles.model, aes(x = Total.Lane.Miles, y = VMT), colour="red")
```


```{r VMT vs. TransitPMT, echo=FALSE}
plot.TransitPMT<-ggplot(VMT.dat.sub, aes(x = TransitPMT, y=VMT))+geom_point() #plot raw data
lm.TransitPMT<-lm(VMT ~ TransitPMT, data=VMT.dat.sub) #fit linear model
```

```{r changepoint analysis TransitPMT, echo=FALSE}
seg.TransitPMT<-segmented(lm.TransitPMT, seg.Z = ~ TransitPMT)
summary(seg.TransitPMT)
slope(seg.TransitPMT)
confint(seg.TransitPMT)
plot.segmented(seg.TransitPMT, res=TRUE, col=2, xlab="Transit PMT", ylab="VMT", pch=16)
TransitPMT.fitted<-fitted(seg.TransitPMT)
TransitPMT.model<-data.frame(TransitPMT=VMT.dat.sub$TransitPMT, VMT=TransitPMT.fitted)
#plot.TransitPMT+geom_line(data = TransitPMT.model, aes(x = TransitPMT, y = VMT), colour="red")
```



```{r VMT vs. EVPrivateandPublicChargingStationLocations, echo=FALSE}
plot.EVPrivateandPublicChargingStationLocations<-ggplot(VMT.dat.sub, aes(x = EVPrivateandPublicChargingStationLocations, y=VMT))+geom_point() #plot raw data
lm.EVPrivateandPublicChargingStationLocations<-lm(VMT ~ EVPrivateandPublicChargingStationLocations, data=VMT.dat.sub) #fit linear model
```

```{r changepoint analysis EVPrivateandPublicChargingStationLocations, echo=FALSE}
seg.EVPrivateandPublicChargingStationLocations<-segmented(lm.EVPrivateandPublicChargingStationLocations, seg.Z = ~ EVPrivateandPublicChargingStationLocations)
summary(seg.EVPrivateandPublicChargingStationLocations)
slope(seg.EVPrivateandPublicChargingStationLocations)
confint(seg.EVPrivateandPublicChargingStationLocations)
plot.segmented(seg.EVPrivateandPublicChargingStationLocations, res=TRUE, col=2, xlab="EVPrivate & Public Charging Station Locations", ylab="VMT", pch=16)
EVPrivateandPublicChargingStationLocations.fitted<-fitted(seg.EVPrivateandPublicChargingStationLocations)
EVPrivateandPublicChargingStationLocations.model<-data.frame(EVPrivateandPublicChargingStationLocations=VMT.dat.sub$EVPrivateandPublicChargingStationLocations, VMT=EVPrivateandPublicChargingStationLocations.fitted)
#plot.EVPrivateandPublicChargingStationLocations+geom_line(data = EVPrivateandPublicChargingStationLocations.model, aes(x = EVPrivateandPublicChargingStationLocations, y = VMT), colour="red")
```



```{r VMT vs. populationTelework, echo=FALSE}
plot.populationTelework<-ggplot(VMT.dat.sub, aes(x = populationTelework, y=VMT))+geom_point() #plot raw data
lm.populationTelework<-lm(VMT ~ populationTelework, data=VMT.dat.sub) #fit linear model
```

```{r changepoint analysis populationTelework, echo=FALSE}
seg.populationTelework<-segmented(lm.populationTelework)
summary(seg.populationTelework)
slope(seg.populationTelework)
confint(seg.populationTelework)
plot.segmented(seg.populationTelework, res=TRUE, col=2, xlab="Population Telework", ylab="VMT", pch=16)
populationTelework.fitted<-fitted(seg.populationTelework)
populationTelework.model<-data.frame(populationTelework=VMT.dat.sub$populationTelework, VMT=populationTelework.fitted)
#plot.populationTelework+geom_line(data = populationTelework.model, aes(x = populationTelework, y = VMT), colour="red")
```

